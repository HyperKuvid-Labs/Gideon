// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-py"
  recursive_type_depth  = 5
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://chats_owner:npg_VsuSd9Nzw8CI@ep-cool-bar-a1hxk2iv-pooler.ap-southeast-1.aws.neon.tech/chats?sslmode=require"
}

enum ModelType {
  ollama
  online
}

enum ModelNameOllama {
  gemma3_27b
  llama3_3_70b
  deepseek_r1_70b
  phi4_14b
}

enum ModelNameOnline {
  gemini2_5_flash
  gemini2_5_pro
  deepseekv3
  claude3_5
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  username String?
  passwordHash String
  QueryResps QueryResp[]
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  conversations Conversation[] @relation("UserConversations")
  authProvider String? @default("jwt")
  authId String?
}

model ModelThing {
  modelId Int @id @default(autoincrement())
  type ModelType @default(ollama)
  name ModelNameOllama @default(gemma3_27b)
  nameOnline ModelNameOnline @default(gemini2_5_flash)
  QueryResps QueryResp[]
  lastReadAt DateTime @default(now())
}

model Conversation {
  id        Int      @id @default(autoincrement())
  users     User[]   @relation("UserConversations")
  roomName String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  queries QueryResp[] @relation("ConversationQueries")
}

model QueryResp {
  id Int @id @default(autoincrement())
  query String
  result String
  ModelUsed ModelThing @relation(fields: [modelId], references: [modelId])
  modelId Int
  user User @relation(fields: [userId], references: [id])
  userId Int
  conversation Conversation @relation("ConversationQueries", fields: [conversationId], references: [id])
  conversationId Int
}

